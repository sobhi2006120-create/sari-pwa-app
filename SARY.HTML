<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<!-- PWA Meta Tags -->
<meta name="theme-color" content="#FFD700">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="ÿµÿßÿ±Ÿä">
<link rel="apple-touch-icon" href="https://i.imgur.com/kP5l1xN.png">

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÿµÿßÿ±Ÿä ÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿ£ÿµÿßŸÑÿ©</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="https://i.imgur.com/kP5l1xN.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://i.imgur.com/kP5l1xN.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://i.imgur.com/kP5l1xN.png">
    <link rel="apple-touch-icon" sizes="180x180" href="https://i.imgur.com/kP5l1xN.png">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoi0YHRg9C00LDRgNGD0LrQsCIsInNob3J0X25hbWUiOiLQgdGD0LTQsNGA0YDQutCwIiwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8vaS5pbWd1ci5jb20va1A1bDF4Ti5wbmciLCJzaXplcyI6IjE5MngxOTIiLCJ0eXBlIjoiaW1hZ2UvcG5nIn1dfQ==">
    
    <meta name="msapplication-TileColor" content="#000000">
    <meta name="msapplication-config" content="browserconfig.xml">
    <meta name="theme-color" content="#000000">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        /* Theme Variables */
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #2a2a2a;
            --bg-quaternary: #3a3a3a;
            --text-primary: #fff;
            --text-secondary: #ccc;
            --text-tertiary: #888;
            --border-color: #444;
            --accent-primary: #FFD700;
            --accent-secondary: #FFA500;
            --shadow-color: rgba(0, 0, 0, 0.5);
            --scrollbar-track: #1a1a1a;
            --glass-bg-dark: rgba(30, 30, 30, 0.7);
            --glass-border-dark: rgba(255, 255, 255, 0.1);
            --glass-bg-light: rgba(255, 255, 255, 0.7);
            --glass-border-light: rgba(0, 0, 0, 0.1);
            /* Table border colors for dark theme */
            --table-border-dark: #FFD700;
            --table-border-light: #000000;
            --table-border: var(--table-border-dark);
        }
        
        /* Light Theme Variables */
        body.light-theme {
            --bg-primary: #ffffff;
            --bg-secondary: #f8f8f8;
            --bg-tertiary: #f0f0f0;
            --bg-quaternary: #e8e8e8;
            --text-primary: #333333;
            --text-secondary: #555555;
            --text-tertiary: #777777;
            --border-color: #dddddd;
            --accent-primary: #FFD700;
            --accent-secondary: #FFA500;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --scrollbar-track: #f0f0f0;
            --glass-bg-dark: rgba(255, 255, 255, 0.7);
            --glass-border-dark: rgba(0, 0, 0, 0.1);
            --glass-bg-light: rgba(255, 255, 255, 0.7);
            --glass-border-light: rgba(0, 0, 0, 0.1);
            --table-border: var(--table-border-light);
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-primary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
            transition: all 0.3s ease;
            position: relative;
        }
        
        /* Main Background - Using the provided image */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://z-cdn-media.chatglm.cn/files/ae100c82-f676-4e6d-a92c-2f6278266f42_Gemini_Generated_Image_owphmtowphmtowph.png?auth_key=1788950472-8e1b976324a34bf5a3ec02662e80341f-0-5fe38c1ef32e2ec4b7dd847623e5674e');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            z-index: -2;
            opacity: 0.95;
            filter: brightness(0.85);
        }
        
        /* Overlay for better readability */
        .bg-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, rgba(10, 10, 10, 0.7) 0%, rgba(26, 26, 26, 0.5) 50%, rgba(10, 10, 10, 0.7) 100%);
            z-index: -1;
        }
        
        body.light-theme .bg-overlay {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.7) 0%, rgba(248, 248, 248, 0.5) 50%, rgba(255, 255, 255, 0.7) 100%);
        }
        
        /* App Container */
        .app-container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }
        
        /* Sidebar - Enhanced Glass Effect */
        .sidebar {
            width: 250px;
            background: rgba(20, 20, 30, 0.75);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            padding: 20px;
            display: none;
            flex-direction: column;
            position: fixed;
            right: 0;
            top: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            transform: translateX(0);
        }
        
        body.light-theme .sidebar {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border-left: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.1);
        }
        
        .sidebar.hidden {
            transform: translateX(100%);
        }
        
        .sidebar.visible {
            transform: translateX(0);
        }
        
        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        body.light-theme .sidebar-header {
            border-bottom: 1px solid rgba(0, 0, 0, 0.15);
        }
        
        .sidebar-header h2 {
            font-size: 20px;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* Customer Search Section - Enhanced Glass Effect */
        .customer-search-section {
            margin-bottom: 20px;
            position: relative;
        }
        
        .search-container {
            position: relative;
            width: 100%;
        }
        
        .search-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: var(--text-primary);
            padding: 12px 40px 12px 15px;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: all 0.3s ease;
        }
        
        body.light-theme .search-input {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: var(--text-primary);
        }
        
        .search-input:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        .search-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
            font-size: 16px;
        }
        
        .search-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            left: 0;
            background: rgba(20, 20, 30, 0.85);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 200;
            display: none;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        body.light-theme .search-dropdown {
            background: rgba(255, 255, 255, 0.95);
            border: 1px solid rgba(0, 0, 0, 0.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .search-dropdown.show {
            display: block;
        }
        
        .search-dropdown-item {
            padding: 12px 15px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        body.light-theme .search-dropdown-item {
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .search-dropdown-item:last-child {
            border-bottom: none;
        }
        
        .search-dropdown-item:hover {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
        }
        
        .search-dropdown-item.no-results {
            text-align: center;
            color: var(--text-tertiary);
            cursor: default;
        }
        
        .search-dropdown-item.no-results:hover {
            background: transparent;
            color: var(--text-tertiary);
        }
        
        /* Driver Search Section - Enhanced Glass Effect */
        .driver-search-section {
            margin-bottom: 20px;
            position: relative;
        }
        
        /* Refresh Section - Enhanced Glass Effect */
        .refresh-section {
            margin-bottom: 20px;
        }
        
        .refresh-btn {
            width: 100%;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .refresh-btn::before {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: right 0.5s ease;
        }
        
        .refresh-btn:hover::before {
            right: 100%;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .refresh-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .refresh-btn.loading {
            pointer-events: none;
        }
        
        .refresh-icon {
            display: inline-block;
            transition: transform 0.3s ease;
        }
        
        .refresh-btn.loading .refresh-icon {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .auto-refresh-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 10px;
            padding: 8px;
            background: rgba(255, 215, 0, 0.15);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 6px;
            font-size: 12px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        body.light-theme .auto-refresh-status {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .auto-refresh-indicator {
            width: 8px;
            height: 8px;
            background: #4CAF50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .auto-refresh-indicator.updating {
            background: var(--accent-primary);
            animation: spin 1s linear infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .last-update {
            text-align: center;
            font-size: 12px;
            color: var(--text-tertiary);
            margin-top: 10px;
        }
        
        /* Sheet Buttons - Enhanced Glass Effect */
        .sheet-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .sheet-btn {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            color: var(--text-primary);
            border: 1px solid rgba(255, 255, 255, 0.2);
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        body.light-theme .sheet-btn {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .sheet-btn::before {
            content: '';
            position: absolute;
            top: 0;
            right: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.3), transparent);
            transition: right 0.5s ease;
        }
        
        .sheet-btn:hover::before {
            right: 100%;
        }
        
        .sheet-btn:hover {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
            transform: translateX(-5px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
        }
        
        .sheet-btn.active {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
            font-weight: bold;
        }
        
        .new-data-badge {
            position: absolute;
            top: -5px;
            left: -5px;
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
            animation: bounce 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            transition: margin-right 0.3s ease;
        }
        
        .main-content.sidebar-open {
            margin-right: 250px;
        }
        
        /* Header - Enhanced Glass Effect */
        .header {
            background: rgba(20, 20, 30, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 20px;
            text-align: center;
            border-bottom: 2px solid var(--accent-primary);
            box-shadow: 0 2px 20px rgba(255, 215, 0, 0.3);
            margin-bottom: 30px;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.light-theme .header {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        /* Company Logo - Clickable */
        .company-logo {
            width: 120px;
            height: 120px;
            margin-bottom: 15px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-primary);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .company-logo:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.5);
        }
        
        .company-logo.fallback {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .company-logo.fallback:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.5);
        }
        
        .header h1 {
            font-size: 28px;
            background: linear-gradient(45deg, var(--accent-primary), var(--accent-secondary), var(--accent-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }
        
        .header p {
            color: var(--text-secondary);
            font-size: 16px;
        }
        
        /* Loading Animation with Progress Bar - Enhanced Glass Effect */
        .loading {
            display: block;
            text-align: center;
            padding: 50px;
        }
        
        .loading-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            background: rgba(20, 20, 30, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            margin: 0 auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.light-theme .loading-content {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid var(--bg-tertiary);
            border-top: 3px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        .progress-container {
            width: 100%;
            max-width: 400px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px var(--shadow-color);
        }
        
        .progress-bar {
            height: 10px;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 10px;
            width: 0%;
            transition: width 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(
                90deg,
                transparent,
                rgba(255, 255, 255, 0.3),
                transparent
            );
            animation: shimmer 1.5s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .progress-text {
            margin-top: 10px;
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: bold;
        }
        
        .loading-steps {
            margin-top: 20px;
            text-align: center;
            color: var(--text-tertiary);
            font-size: 14px;
            line-height: 1.6;
        }
        
        .step {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 8px;
            opacity: 0.5;
            transition: opacity 0.3s ease;
        }
        
        .step.active {
            opacity: 1;
            color: var(--accent-primary);
        }
        
        .step.completed {
            opacity: 0.8;
            color: var(--text-secondary);
        }
        
        .step-icon {
            font-size: 16px;
        }
        
        /* Full Screen Sheet View - Enhanced Glass Effect */
        .sheet-view {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 200;
            overflow: auto;
        }
        
        .sheet-header {
            background: rgba(20, 20, 30, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid var(--accent-primary);
            position: sticky;
            top: 0;
            z-index: 10;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.light-theme .sheet-header {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .sheet-header::before {
            content: '';
            width: 30px;
            height: 30px;
            background-image: url('https://i.imgur.com/kP5l1xN.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            margin-left: 10px;
        }
        
        .back-btn {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
        }
        
        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .sheet-title {
            color: var(--accent-primary);
            font-size: 18px;
            font-weight: bold;
        }
        
        .sheet-content {
            padding: 20px;
        }
        
        /* Table Container - Enhanced with Clear Borders */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            border: 4px solid var(--table-border);
            border-radius: 15px;
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            background: var(--bg-primary);
            position: relative;
        }
        
        .table-container::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            pointer-events: none;
            z-index: 1;
        }
        
        .excel-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 12px;
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid var(--table-border);
        }
        
        .excel-table th,
        .excel-table td {
            border: 3px solid var(--table-border);
            padding: 12px;
            text-align: right;
            min-width: 100px;
            white-space: nowrap;
            position: relative;
            background-clip: padding-box;
            transition: all 0.2s ease;
            box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.1);
        }
        
        /* Enhanced header borders */
        .excel-table th {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
            border: 4px solid var(--table-border);
            border-bottom: 5px solid var(--table-border);
            box-shadow: 
                inset 0 0 0 1px rgba(255, 255, 255, 0.3),
                0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Enhanced cell borders */
        .excel-table td {
            background-color: var(--bg-primary);
            border-right: 3px solid var(--table-border);
            border-left: 3px solid var(--table-border);
            border-top: 2px solid var(--table-border);
            border-bottom: 2px solid var(--table-border);
        }
        
        body.light-theme .excel-table td {
            background-color: var(--bg-primary);
        }
        
        /* Enhanced hover effects */
        .excel-table tr:hover td {
            background-color: rgba(255, 215, 0, 0.15);
            border-color: var(--table-border);
            box-shadow: 
                inset 0 0 0 1px rgba(255, 215, 0, 0.3),
                0 0 8px rgba(255, 215, 0, 0.2);
        }
        
        /* Double border effect for better separation */
        .excel-table tr:nth-child(even) td {
            border-top: 3px solid var(--table-border);
            border-bottom: 3px solid var(--table-border);
        }
        
        .excel-table tr:nth-child(odd) td {
            border-top: 2px solid var(--table-border);
            border-bottom: 2px solid var(--table-border);
        }
        
        /* Special border for first column */
        .excel-table td:first-child {
            border-right: 4px solid var(--table-border);
            font-weight: 500;
        }
        
        /* Special border for last column */
        .excel-table td:last-child {
            border-left: 4px solid var(--table-border);
        }
        
        /* Enhanced light theme borders */
        body.light-theme .excel-table th,
        body.light-theme .excel-table td {
            border-color: var(--table-border-light);
        }
        
        body.light-theme .excel-table th {
            border-color: var(--table-border-light);
            border-bottom: 4px solid var(--table-border-light);
        }
        
        body.light-theme .excel-table tr:hover td {
            border-color: var(--table-border-light);
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        /* Cell focus effect */
        .excel-table td:focus,
        .excel-table th:focus {
            outline: 3px solid var(--table-border);
            outline-offset: -2px;
            z-index: 1;
            position: relative;
        }
        
        /* New Data Highlight */
        .new-data {
            animation: highlightNewData 3s ease-in-out;
            position: relative;
        }
        
        .new-data::before {
            content: 'ÿ¨ÿØŸäÿØ';
            position: absolute;
            top: -10px;
            left: -10px;
            background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%);
            color: white;
            font-size: 9px;
            padding: 2px 5px;
            border-radius: 8px;
            font-weight: bold;
            z-index: 10;
        }
        
        @keyframes highlightNewData {
            0% { 
                background-color: rgba(255, 215, 0, 0.8);
                transform: scale(1.05);
            }
            50% { 
                background-color: rgba(255, 215, 0, 0.4);
                transform: scale(1.02);
            }
            100% { 
                background-color: transparent;
                transform: scale(1);
            }
        }
        
        /* Pivot Table Filter Dropdown */
        .pivot-filter {
            position: relative;
            cursor: pointer;
            background-color: #f0f0f0;
        }
        
        .pivot-filter::after {
            content: '‚ñº';
            position: absolute;
            left: 5px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            color: #666;
        }
        
        .pivot-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            min-width: 150px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }
        
        .pivot-dropdown.show {
            display: block;
        }
        
        .pivot-dropdown-item {
            padding: 8px 12px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .pivot-dropdown-item:hover {
            background-color: #f0f0f0;
        }
        
        .pivot-dropdown-item.selected {
            background-color: var(--accent-primary);
            color: #000;
        }
        
        /* Frozen pane indicator */
        .frozen-column {
            position: sticky;
            left: 0;
            background: #f8f8f8 !important;
            z-index: 5;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }
        
        .frozen-column-header {
            position: sticky;
            left: 0;
            top: 0;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%) !important;
            z-index: 20;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
        }
        
        /* Toast Notification - Enhanced Glass Effect */
        .toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px var(--shadow-color);
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
            font-weight: bold;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .toast.show {
            opacity: 1;
        }
        
        .toast.success {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }
        
        .toast.info {
            background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%);
        }
        
        /* Error Message - Enhanced Glass Effect */
        .error-message {
            display: none;
            background: linear-gradient(135deg, #ff5252 0%, #ff1744 100%);
            color: white;
            padding: 15px;
            margin: 20px;
            border-radius: 10px;
            text-align: center;
            font-weight: bold;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .retry-btn {
            background: white;
            color: #ff1744;
            border: none;
            padding: 8px 16px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-top: 10px;
            transition: all 0.3s ease;
        }
        
        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 255, 255, 0.3);
        }
        
        /* Update Animation - Enhanced Glass Effect */
        .update-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 300;
        }
        
        .update-overlay.show {
            display: flex;
        }
        
        .update-content {
            background: rgba(20, 20, 30, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid var(--accent-primary);
            text-align: center;
            box-shadow: 0 10px 30px rgba(255, 215, 0, 0.3);
        }
        
        body.light-theme .update-content {
            background: rgba(255, 255, 255, 0.8);
        }
        
        .update-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        .update-text {
            color: var(--accent-primary);
            font-size: 18px;
            font-weight: bold;
        }
        
        /* Theme Toggle Button */
        .theme-toggle-btn {
            position: fixed;
            bottom: 80px;
            left: 20px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            transition: all 0.3s ease;
            z-index: 150;
        }
        
        .theme-toggle-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }
        
        .theme-toggle-btn:active {
            transform: translateY(-1px);
        }
        
        .theme-icon {
            font-size: 18px;
            transition: transform 0.3s ease;
        }
        
        .theme-toggle-btn:hover .theme-icon {
            transform: rotate(180deg);
        }
        
        /* Designer Button */
        .designer-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
            border: none;
            padding: 12px 24px;
            border-radius: 30px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            transition: all 0.3s ease;
            z-index: 150;
        }
        
        .designer-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.6);
        }
        
        .designer-btn:active {
            transform: translateY(-1px);
        }
        
        .designer-icon {
            font-size: 18px;
        }
        
        /* Designer Modal - Enhanced Glass Effect */
        .designer-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .designer-modal.show {
            display: flex;
            opacity: 1;
        }
        
        .modal-content {
            background: rgba(20, 20, 30, 0.7);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 2px solid var(--accent-primary);
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            padding: 30px;
            position: relative;
            box-shadow: 0 10px 30px var(--shadow-color);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        
        body.light-theme .modal-content {
            background: rgba(255, 255, 255, 0.8);
        }
        
        .designer-modal.show .modal-content {
            transform: scale(1);
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            left: 15px;
            background: none;
            border: none;
            color: var(--accent-primary);
            font-size: 24px;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }
        
        .modal-close:hover {
            background: rgba(255, 215, 0, 0.2);
            transform: rotate(90deg);
        }
        
        .modal-header {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .modal-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .modal-header h2 {
            color: var(--accent-primary);
            font-size: 24px;
            margin: 0;
        }
        
        .modal-body {
            text-align: center;
        }
        
        .designer-info {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 215, 0, 0.15);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        body.light-theme .designer-info {
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .designer-info h3 {
            color: var(--accent-primary);
            font-size: 20px;
            margin-bottom: 5px;
        }
        
        .designer-info p {
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        .contact-info {
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        body.light-theme .contact-info {
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .contact-info p {
            color: var(--text-tertiary);
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .phone-link {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            color: #000;
            text-decoration: none;
            padding: 12px 20px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        
        .phone-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .phone-icon {
            font-size: 20px;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                width: 200px;
            }
            .main-content.sidebar-open {
                margin-right: 200px;
            }
            .company-logo {
                width: 100px;
                height: 100px;
                font-size: 40px;
            }
            .header h1 {
                font-size: 24px;
            }
            .header::before {
                width: 30px;
                height: 30px;
            }
            .upload-area {
                padding: 30px 15px;
            }
            .sheet-btn {
                padding: 12px;
                font-size: 12px;
            }
            .excel-table th,
            .excel-table td {
                padding: 10px;
                font-size: 11px;
                min-width: 80px;
                border-width: 2px;
            }
            
            .excel-table th {
                border-width: 3px;
                border-bottom-width: 4px;
            }
            
            .theme-toggle-btn {
                padding: 10px 16px;
                font-size: 12px;
                bottom: 75px;
                left: 15px;
            }
            .designer-btn {
                padding: 10px 16px;
                font-size: 12px;
                bottom: 15px;
                left: 15px;
            }
            .modal-content {
                width: 95%;
                padding: 20px;
            }
            .modal-header h2 {
                font-size: 20px;
            }
            .designer-info h3 {
                font-size: 18px;
            }
            .phone-link {
                font-size: 14px;
                padding: 10px 16px;
            }
        }
        
        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--scrollbar-track);
        }
        
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, var(--accent-secondary) 0%, var(--accent-primary) 100%);
        }
        
        /* Hidden class */
        .hidden {
            display: none !important;
        }
        
        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #ff5252 0%, #ff1744 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .offline-indicator.show {
            display: flex;
        }
        
        .offline-icon {
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="bg-overlay"></div>
    <div class="app-container">
        <!-- Sidebar -->
        <div class="sidebar hidden" id="sidebar">
            <div class="sidebar-header">
                <h2>ÿµŸÅÿ≠ÿßÿ™ ÿßŸÑŸÖŸÑŸÅ</h2>
            </div>
            
            <!-- Customer Search Section -->
            <div class="customer-search-section">
                <div class="search-container">
                    <input type="text" class="search-input" id="customerSearchInput" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ≤ÿ®ŸàŸÜ...">
                    <span class="search-icon">üîç</span>
                    <div class="search-dropdown" id="searchDropdown"></div>
                </div>
            </div>
            
            <!-- Driver Search Section -->
            <div class="driver-search-section">
                <div class="search-container">
                    <input type="text" class="search-input" id="driverSearchInput" placeholder="ÿßÿ®ÿ≠ÿ´ ÿπŸÜ ÿ≥ÿßÿ¶ŸÇ...">
                    <span class="search-icon">üîç</span>
                    <div class="search-dropdown" id="driverSearchDropdown"></div>
                </div>
            </div>
            
            <!-- Refresh Section -->
            <div class="refresh-section">
                <button class="refresh-btn" id="refreshBtn" onclick="refreshData()">
                    <span class="refresh-icon">üîÑ</span>
                    <span>ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™</span>
                </button>
                <div class="auto-refresh-status">
                    <div class="auto-refresh-indicator" id="autoRefreshIndicator"></div>
                    <span>ÿ™ÿ≠ÿØŸäÿ´ ÿ™ŸÑŸÇÿßÿ¶Ÿä</span>
                </div>
                <div class="last-update" id="lastUpdate">ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´: --:--</div>
            </div>
            
            <div class="sheet-buttons" id="sheetButtons"></div>
        </div>
        
        <!-- Main Content -->
        <div class="main-content" id="mainContent">
            <header class="header">
                <!-- Company Logo -->
                <div class="company-logo fallback" id="companyLogo" onclick="toggleSidebar()">
                    ÿµÿßÿ±Ÿä
                </div>
                
                <h1>ÿµÿßÿ±Ÿä ÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿ£ÿµÿßŸÑÿ©</h1>
                <p>ÿπÿ±ÿ∂ ŸÖŸÑŸÅÿßÿ™ ÿßŸÑÿ•ŸÉÿ≥ŸÑ ÿ®ŸÉŸÑ ÿ™ŸÅÿßÿµŸäŸÑŸáÿß ÿπŸÑŸâ Ÿáÿßÿ™ŸÅŸÉ</p>
            </header>
            <div class="loading" id="loading">
                <div class="loading-content">
                    <div class="loading-spinner"></div>
                    <div class="progress-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-text" id="progressText">0%</div>
                    <div class="loading-steps">
                        <div class="step" id="step1">
                            <span class="step-icon">üì°</span>
                            <span>ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿÆÿßÿØŸÖ...</span>
                        </div>
                        <div class="step" id="step2">
                            <span class="step-icon">üì•</span>
                            <span>ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...</span>
                        </div>
                        <div class="step" id="step3">
                            <span class="step-icon">üîç</span>
                            <span>ŸÖÿπÿßŸÑÿ¨ÿ© ÿßŸÑŸÖŸÑŸÅ...</span>
                        </div>
                        <div class="step" id="step4">
                            <span class="step-icon">‚úÖ</span>
                            <span>ÿ•ÿπÿØÿßÿØ ÿßŸÑŸàÿßÿ¨Ÿáÿ©...</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="error-message" id="errorMessage">
                <p>ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿµŸÑÿßÿ≠Ÿäÿßÿ™ ÿßŸÑŸàÿµŸàŸÑ ÿ•ŸÑŸâ ÿßŸÑŸÖŸÑŸÅ.</p>
                <button class="retry-btn" onclick="loadGoogleSheet()">ÿ•ÿπÿßÿØÿ© ÿßŸÑŸÖÿ≠ÿßŸàŸÑÿ©</button>
            </div>
            <section class="upload-section" id="uploadSection">
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <div class="upload-icon">üìä</div>
                    <div class="upload-text">ÿßÿÆÿ™ÿ± ŸÖŸÑŸÅ ÿßŸÑÿ•ŸÉÿ≥ŸÑ</div>
                    <div class="upload-subtext">ÿ£Ÿà ÿßÿ≥ÿ≠ÿ® Ÿàÿ£ŸÅŸÑÿ™ ÿßŸÑŸÖŸÑŸÅ ŸáŸÜÿß</div>
                </div>
                <input type="file" id="fileInput" accept=".xlsx,.xls" />
            </section>
        </div>
    </div>
    
    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offlineIndicator">
        <span class="offline-icon">üìµ</span>
        <span>Ÿàÿ∂ÿπ ÿπÿØŸÖ ÿßŸÑÿßÿ™ÿµÿßŸÑ</span>
    </div>
    
    <!-- Theme Toggle Button -->
    <button class="theme-toggle-btn" id="themeToggleBtn">
        <span class="theme-icon" id="themeIcon">üåô</span>
        <span id="themeText">ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÜŸáÿßÿ±Ÿä</span>
    </button>
    
    <!-- Designer Button -->
    <button class="designer-btn" id="designerBtn">
        <span class="designer-icon">üë®‚Äçüíª</span>
        <span>ÿπŸÜ ÿßŸÑŸÖÿµŸÖŸÖ</span>
    </button>
    
    <!-- Designer Modal -->
    <div class="designer-modal" id="designerModal">
        <div class="modal-content">
            <button class="modal-close" id="modalClose">√ó</button>
            <div class="modal-header">
                <div class="modal-icon">üë®‚Äçüíª</div>
                <h2>ÿµŸÖŸÖ ŸÖŸÜ ŸÇÿ®ŸÑ</h2>
            </div>
            <div class="modal-body">
                <div class="designer-info">
                    <h3>ŸÖ. ÿµÿ®ÿ≠Ÿä ŸÅÿßÿÆŸàÿ±Ÿä</h3>
                    <p>ŸÖŸáŸÜÿØÿ≥ ŸÖŸäŸÉÿßÿ™ÿ±ŸàŸÜŸÉÿ≥</p>
                </div>
                <div class="contact-info">
                    <p>ŸÑŸÑÿ™ŸàÿßÿµŸÑ ŸàÿßŸÑÿßÿ≥ÿ™ŸÅÿ≥ÿßÿ±ÿßÿ™:</p>
                    <a href="tel:+963995248838" class="phone-link">
                        <span class="phone-icon">üì±</span>
                        <span>+963 995 248 838</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Full Screen Sheet View -->
    <div class="sheet-view" id="sheetView">
        <div class="sheet-header">
            <button class="back-btn" onclick="closeSheetView()">
                <span>‚Üê</span>
                <span>ÿ±ÿ¨Ÿàÿπ</span>
            </button>
            <div class="sheet-title" id="sheetTitle"></div>
            <div></div>
        </div>
        <div class="sheet-content">
            <div class="table-container">
                <table class="excel-table" id="excelTable"></table>
            </div>
        </div>
    </div>
    
    <!-- Update Overlay -->
    <div class="update-overlay" id="updateOverlay">
        <div class="update-content">
            <div class="update-spinner"></div>
            <div class="update-text">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™...</div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <script>
        let workbook = null;
        let currentSheetIndex = 0;
        let frozenColumns = 0;
        let pivotTables = {};
        let autoRefreshInterval = null;
        let lastRefreshTime = null;
        let previousData = null;
        let customerNames = [];
        let driverNames = [];
        let customerNameColumn = -1;
        let driverNameColumn = -1;
        let progressInterval = null;
        
        // Local storage keys
        const LOCAL_STORAGE_KEY = 'sari_app_data';
        const LOCAL_STORAGE_TIMESTAMP_KEY = 'sari_app_timestamp';
        
        // Google Sheet ID
        const GOOGLE_SHEET_ID = "1jBA0TGJrtF9jwDXfMHYYtr04_YS5lQUV";
        const GOOGLE_SHEET_URL = `https://docs.google.com/spreadsheets/d/${GOOGLE_SHEET_ID}/export?format=xlsx`;
        const AUTO_REFRESH_INTERVAL = 30000; // 30 seconds
        
        // Function to save data locally
        function saveDataLocally(workbookData) {
            try {
                // Convert workbook data to JSON format
                const workbookJson = {
                    SheetNames: workbookData.SheetNames,
                    Sheets: {}
                };
                
                // Convert each worksheet to a simple format
                for (const sheetName of workbookData.SheetNames) {
                    const worksheet = workbookData.Sheets[sheetName];
                    workbookJson.Sheets[sheetName] = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
                }
                
                // Save data and timestamp to local storage
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(workbookJson));
                localStorage.setItem(LOCAL_STORAGE_TIMESTAMP_KEY, Date.now().toString());
                
                console.log('Data saved locally successfully');
                return true;
            } catch (error) {
                console.error('Error saving data locally:', error);
                return false;
            }
        }
        
        // Function to load data from local storage
        function loadDataLocally() {
            try {
                const storedData = localStorage.getItem(LOCAL_STORAGE_KEY);
                const storedTimestamp = localStorage.getItem(LOCAL_STORAGE_TIMESTAMP_KEY);
                
                if (!storedData || !storedTimestamp) {
                    return null;
                }
                
                // Parse stored data
                const workbookJson = JSON.parse(storedData);
                const timestamp = parseInt(storedTimestamp);
                
                // Rebuild workbook
                const newWorkbook = XLSX.utils.book_new();
                
                for (const sheetName of workbookJson.SheetNames) {
                    const sheetData = workbookJson.Sheets[sheetName];
                    const worksheet = XLSX.utils.aoa_to_sheet(sheetData);
                    XLSX.utils.book_append_sheet(newWorkbook, worksheet, sheetName);
                }
                
                // Calculate time elapsed since last update
                const lastUpdate = new Date(timestamp);
                const now = new Date();
                const diffHours = Math.floor((now - lastUpdate) / (1000 * 60 * 60));
                
                return {
                    workbook: newWorkbook,
                    lastUpdate: lastUpdate,
                    diffHours: diffHours
                };
            } catch (error) {
                console.error('Error loading local data:', error);
                return null;
            }
        }
        
        // Function to check internet connection
        function checkInternetConnection() {
            return navigator.onLine;
        }
        
        // Load Google Sheet on page load
        window.onload = function() {
            loadGoogleSheet();
            initDesignerModal();
            initThemeToggle();
            tryLoadCompanyLogo();
            initCustomerSearch();
            initDriverSearch();
            
            // Add event listeners for online/offline status
            window.addEventListener('online', () => {
                document.getElementById('offlineIndicator').classList.remove('show');
                showToast('ÿ™ŸÖ ÿßÿ≥ÿ™ÿπÿßÿØÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™', 'success');
                // Retry loading data from internet
                loadGoogleSheet();
            });
            
            window.addEventListener('offline', () => {
                document.getElementById('offlineIndicator').classList.add('show');
                showToast('ŸÅŸÇÿØÿßŸÜ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™', 'error');
            });
        };
        
        // Function to toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            
            if (sidebar.classList.contains('hidden')) {
                // Open sidebar
                sidebar.classList.remove('hidden');
                sidebar.classList.add('visible');
                mainContent.classList.add('sidebar-open');
                sidebar.style.display = 'flex';
            } else {
                // Close sidebar
                sidebar.classList.remove('visible');
                sidebar.classList.add('hidden');
                mainContent.classList.remove('sidebar-open');
                setTimeout(() => {
                    if (sidebar.classList.contains('hidden')) {
                        sidebar.style.display = 'none';
                    }
                }, 300); // Wait for transition to complete
            }
        }
        
        function initThemeToggle() {
            const themeToggleBtn = document.getElementById('themeToggleBtn');
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            // Load saved theme preference
            const savedTheme = localStorage.getItem('theme') || 'dark';
            if (savedTheme === 'light') {
                document.body.classList.add('light-theme');
                themeIcon.textContent = '‚òÄÔ∏è';
                themeText.textContent = 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä';
            }
            
            themeToggleBtn.addEventListener('click', function() {
                const isLightTheme = document.body.classList.toggle('light-theme');
                
                if (isLightTheme) {
                    themeIcon.textContent = '‚òÄÔ∏è';
                    themeText.textContent = 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä';
                    localStorage.setItem('theme', 'light');
                    showToast('ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÜŸáÿßÿ±Ÿä', 'info');
                } else {
                    themeIcon.textContent = 'üåô';
                    themeText.textContent = 'ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÜŸáÿßÿ±Ÿä';
                    localStorage.setItem('theme', 'dark');
                    showToast('ÿ™ŸÖ ÿßŸÑÿ™ÿ®ÿØŸäŸÑ ÿ•ŸÑŸâ ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä', 'info');
                }
            });
        }
        
        function tryLoadCompanyLogo() {
            const logoDiv = document.getElementById('companyLogo');
            const img = new Image();
            
            // Try multiple URL formats for Google Drive image
            const urls = [
                'https://drive.google.com/uc?export=view&id=1UGynKeHTyFK8w2k9zSId4j1o3wyR8N7t',
                'https://drive.google.com/thumbnail?id=1UGynKeHTyFK8w2k9zSId4j1o3wyR8N7t&sz=w120-h120',
                'https://lh3.googleusercontent.com/d/1UGynKeHTyFK8w2k9zSId4j1o3wyR8N7t=w120-h120'
            ];
            
            let currentIndex = 0;
            
            function tryNextUrl() {
                if (currentIndex >= urls.length) {
                    // All URLs failed, keep the fallback
                    return;
                }
                
                img.src = urls[currentIndex];
            }
            
            img.onload = function() {
                logoDiv.innerHTML = '';
                logoDiv.appendChild(img);
                logoDiv.classList.remove('fallback');
            };
            
            img.onerror = function() {
                currentIndex++;
                tryNextUrl();
            };
            
            // Start trying URLs
            tryNextUrl();
        }
        
        function updateProgress(percent, step = null) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressBar.style.width = percent + '%';
            progressText.textContent = Math.round(percent) + '%';
            
            // Update step indicators
            if (step) {
                for (let i = 1; i <= 4; i++) {
                    const stepElement = document.getElementById(`step${i}`);
                    if (i < step) {
                        stepElement.classList.add('completed');
                        stepElement.classList.remove('active');
                    } else if (i === step) {
                        stepElement.classList.add('active');
                        stepElement.classList.remove('completed');
                    } else {
                        stepElement.classList.remove('active', 'completed');
                    }
                }
            }
        }
        
        function startProgressSimulation() {
            let progress = 0;
            let currentStep = 1;
            
            // Reset progress
            updateProgress(0, 1);
            
            progressInterval = setInterval(() => {
                progress += Math.random() * 25; // Increased increment for faster progress
                progress = Math.min(progress, 100);
                
                // Update step based on progress
                if (progress >= 75 && currentStep < 4) {
                    currentStep = 4;
                    updateProgress(progress, currentStep);
                } else if (progress >= 50 && currentStep < 3) {
                    currentStep = 3;
                    updateProgress(progress, currentStep);
                } else if (progress >= 25 && currentStep < 2) {
                    currentStep = 2;
                    updateProgress(progress, currentStep);
                } else {
                    updateProgress(progress, currentStep);
                }
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, 100); // Reduced interval time for faster updates
        }
        
        function stopProgressSimulation() {
            if (progressInterval) {
                clearInterval(progressInterval);
                progressInterval = null;
            }
            updateProgress(100, 4);
        }
        
        function loadGoogleSheet() {
            // Check if there's an internet connection
            if (!checkInternetConnection()) {
                // Try to load data from local storage
                const localData = loadDataLocally();
                
                if (localData) {
                    // Show message to user
                    showToast(`ŸÑÿß ŸäŸàÿ¨ÿØ ÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™. ÿ™ŸÖ ÿπÿ±ÿ∂ ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ŸÑŸä (ŸÖŸÜÿ∞ ${localData.diffHours} ÿ≥ÿßÿπÿ©)`, 'info');
                    
                    // Use local data
                    workbook = localData.workbook;
                    previousData = {
                        sheets: workbook.SheetNames.length,
                        sheetNames: [...workbook.SheetNames]
                    };
                    
                    // Extract customer names
                    extractNames();
                    
                    // Create sheet buttons
                    createSheetButtons(workbook.SheetNames);
                    
                    // Show sidebar as hidden by default
                    const sidebar = document.getElementById('sidebar');
                    sidebar.style.display = 'none';
                    sidebar.classList.add('hidden');
                    
                    // Update last refresh time
                    lastRefreshTime = localData.lastUpdate;
                    updateLastRefreshTime();
                    
                    // Stop auto refresh
                    if (autoRefreshInterval) {
                        clearInterval(autoRefreshInterval);
                        autoRefreshInterval = null;
                    }
                    
                    // Change auto refresh indicator status
                    document.getElementById('autoRefreshIndicator').style.background = '#888';
                    
                    // Show message that app is ready
                    setTimeout(() => {
                        showToast('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÑŸäÿ©ÿå ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿπÿßÿ± ŸÑŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©', 'success');
                    }, 300);
                    
                    return;
                } else {
                    // No local data available
                    document.getElementById('loading').style.display = 'none';
                    showToast('ŸÑÿß ŸäŸàÿ¨ÿØ ÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™ ŸàŸÑÿß ÿ™Ÿàÿ¨ÿØ ÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ŸÑŸäÿ©', 'error');
                    document.getElementById('uploadSection').style.display = 'block';
                    return;
                }
            }
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('uploadSection').style.display = 'none';
            
            // Start progress simulation
            startProgressSimulation();
            
            // Set a timeout to ensure loading doesn't take too long
            const loadingTimeout = setTimeout(() => {
                stopProgressSimulation();
                document.getElementById('loading').style.display = 'none';
                showToast('ÿ™ŸÖ ÿ•ÿπÿØÿßÿØ ÿßŸÑŸàÿßÿ¨Ÿáÿ© ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            }, 5000); // 5 seconds max loading time
            
            fetch(GOOGLE_SHEET_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.arrayBuffer();
                })
                .then(data => {
                    clearTimeout(loadingTimeout);
                    
                    try {
                        // Update progress to 75% when data is loaded
                        updateProgress(75, 3);
                        
                        // Process workbook with performance optimizations
                        const startTime = performance.now();
                        
                        // Use optimized options for faster processing
                        workbook = XLSX.read(data, {
                            type: 'array',
                            cellStyles: false, // Skip cell styles for faster processing
                            cellNF: false, // Skip number formats
                            raw: true // Use raw values
                        });
                        
                        const processingTime = performance.now() - startTime;
                        console.log(`Workbook processed in ${processingTime.toFixed(2)}ms`);
                        
                        // Update progress to 90% when workbook is read
                        updateProgress(90, 4);
                        
                        // Store previous data for comparison (simplified)
                        previousData = {
                            sheets: workbook.SheetNames.length,
                            sheetNames: [...workbook.SheetNames]
                        };
                        
                        // Save data locally
                        saveDataLocally(workbook);
                        
                        // Extract customer names only (optimized)
                        extractNames();
                        
                        // Create sheet buttons
                        createSheetButtons(workbook.SheetNames);
                        
                        // Show sidebar as hidden by default
                        const sidebar = document.getElementById('sidebar');
                        sidebar.style.display = 'none';
                        sidebar.classList.add('hidden');
                        
                        document.getElementById('loading').style.display = 'none';
                        
                        // Stop progress simulation
                        stopProgressSimulation();
                        
                        // Update last refresh time
                        updateLastRefreshTime();
                        
                        // Start auto refresh
                        startAutoRefresh();
                        
                        // Show notification that app is ready
                        setTimeout(() => {
                            showToast('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿ®ŸÜÿ¨ÿßÿ≠ÿå ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿπÿßÿ± ŸÑŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©', 'success');
                        }, 300);
                    } catch (error) {
                        console.error('Error processing file:', error);
                        stopProgressSimulation();
                        showError();
                    }
                })
                .catch(error => {
                    clearTimeout(loadingTimeout);
                    console.error('Error loading Google Sheet:', error);
                    stopProgressSimulation();
                    
                    // Try to load data from local storage when internet connection fails
                    const localData = loadDataLocally();
                    
                    if (localData) {
                        showToast('ŸÅÿ¥ŸÑ ÿßŸÑÿßÿ™ÿµÿßŸÑ ÿ®ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™. ÿ™ŸÖ ÿπÿ±ÿ∂ ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´ ŸÖÿ≠ŸÑŸä', 'info');
                        
                        // Use local data
                        workbook = localData.workbook;
                        previousData = {
                            sheets: workbook.SheetNames.length,
                            sheetNames: [...workbook.SheetNames]
                        };
                        
                        // Extract customer names
                        extractNames();
                        
                        // Create sheet buttons
                        createSheetButtons(workbook.SheetNames);
                        
                        // Show sidebar as hidden by default
                        const sidebar = document.getElementById('sidebar');
                        sidebar.style.display = 'none';
                        sidebar.classList.add('hidden');
                        
                        // Update last refresh time
                        lastRefreshTime = localData.lastUpdate;
                        updateLastRefreshTime();
                        
                        // Stop auto refresh
                        if (autoRefreshInterval) {
                            clearInterval(autoRefreshInterval);
                            autoRefreshInterval = null;
                        }
                        
                        // Change auto refresh indicator status
                        document.getElementById('autoRefreshIndicator').style.background = '#888';
                        
                        // Show message that app is ready
                        setTimeout(() => {
                            showToast('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ≠ŸÑŸäÿ©ÿå ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿπÿßÿ± ŸÑŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©', 'success');
                        }, 300);
                    } else {
                        showError();
                    }
                });
        }
        
        function startAutoRefresh() {
            // Clear existing interval
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            // Start new interval
            autoRefreshInterval = setInterval(() => {
                autoRefreshData();
            }, AUTO_REFRESH_INTERVAL);
            
            // Update indicator
            const indicator = document.getElementById('autoRefreshIndicator');
            indicator.classList.remove('updating');
        }
        
        function autoRefreshData() {
            const indicator = document.getElementById('autoRefreshIndicator');
            indicator.classList.add('updating');
            
            fetch(GOOGLE_SHEET_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.arrayBuffer();
                })
                .then(data => {
                    try {
                        const newWorkbook = XLSX.read(data, {
                            type: 'array',
                            cellStyles: false,
                            cellNF: false,
                            raw: true
                        });
                        
                        // Simple change detection
                        const hasChanges = newWorkbook.SheetNames.length !== (previousData?.sheets || 0);
                        
                        if (hasChanges) {
                            // Update workbook
                            workbook = newWorkbook;
                            previousData = {
                                sheets: workbook.SheetNames.length,
                                sheetNames: [...workbook.SheetNames]
                            };
                            
                            // Save data locally
                            saveDataLocally(workbook);
                            
                            // Extract customer names
                            extractNames();
                            
                            // Update sheet buttons if needed
                            createSheetButtons(workbook.SheetNames);
                            
                            // Update current sheet if open
                            if (document.getElementById('sheetView').style.display === 'block') {
                                openSheetView(currentSheetIndex);
                            }
                            
                            // Update last refresh time
                            updateLastRefreshTime();
                            
                            // Show notification
                            showToast('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'success');
                        }
                    } catch (error) {
                        console.error('Error processing file:', error);
                    }
                })
                .catch(error => {
                    console.error('Error auto refreshing data:', error);
                })
                .finally(() => {
                    indicator.classList.remove('updating');
                });
        }
        
        function extractNames() {
            customerNames = [];
            driverNames = [];
            customerNameColumn = -1;
            driverNameColumn = -1;
            
            // Find the "ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä" sheet
            const sheetIndex = workbook.SheetNames.findIndex(name => name.trim() === 'ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä');
            if (sheetIndex === -1) return;
            
            const worksheet = workbook.Sheets[workbook.SheetNames[sheetIndex]];
            if (!worksheet['!ref']) return;
            
            const range = XLSX.utils.decode_range(worksheet['!ref']);
            
            // Find the "ÿßÿ≥ŸÖ ÿßŸÑÿ≤ÿ®ŸàŸÜ" and "ÿßÿ≥ŸÖ ÿßŸÑÿ≥ÿßÿ¶ŸÇ" columns
            for (let C = range.s.c; C <= Math.min(range.s.c + 10, range.e.c); C++) {
                for (let R = range.s.r; R <= Math.min(range.s.r + 5, range.e.r); R++) {
                    const cellAddress = XLSX.utils.encode_cell({r: R, c: C});
                    const cell = worksheet[cellAddress];
                    
                    if (cell && cell.v && typeof cell.v === 'string') {
                        if (cell.v.includes('ÿßÿ≥ŸÖ ÿßŸÑÿ≤ÿ®ŸàŸÜ') && customerNameColumn === -1) {
                            customerNameColumn = C;
                        }
                        if (cell.v.includes('ÿßÿ≥ŸÖ ÿßŸÑÿ≥ÿßÿ¶ŸÇ') && driverNameColumn === -1) {
                            driverNameColumn = C;
                        }
                    }
                }
                if (customerNameColumn !== -1 && driverNameColumn !== -1) break;
            }
            
            // Extract unique customer names
            if (customerNameColumn !== -1) {
                const namesSet = new Set();
                for (let R = range.s.r + 1; R <= Math.min(range.s.r + 100, range.e.r); R++) {
                    const cellAddress = XLSX.utils.encode_cell({r: R, c: customerNameColumn});
                    const cell = worksheet[cellAddress];
                    if (cell && cell.v && cell.v.toString().trim() !== '') {
                        namesSet.add(cell.v.toString().trim());
                    }
                }
                customerNames = Array.from(namesSet).sort();
            }
            
            // Extract unique driver names
            if (driverNameColumn !== -1) {
                const namesSet = new Set();
                for (let R = range.s.r + 1; R <= Math.min(range.s.r + 100, range.e.r); R++) {
                    const cellAddress = XLSX.utils.encode_cell({r: R, c: driverNameColumn});
                    const cell = worksheet[cellAddress];
                    if (cell && cell.v && cell.v.toString().trim() !== '') {
                        namesSet.add(cell.v.toString().trim());
                    }
                }
                driverNames = Array.from(namesSet).sort();
            }
        }
        
        function updateLastRefreshTime() {
            const now = new Date();
            lastRefreshTime = now;
            const timeString = now.toLocaleTimeString('ar-SA', {
                hour: '2-digit',
                minute: '2-digit'
            });
            document.getElementById('lastUpdate').textContent = `ÿ¢ÿÆÿ± ÿ™ÿ≠ÿØŸäÿ´: ${timeString}`;
        }
        
        function showError() {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'block';
            document.getElementById('uploadSection').style.display = 'block';
        }
        
        // File input handler (for local files)
        document.getElementById('fileInput').addEventListener('change', handleFile);
        
        // Drag and drop handlers
        const uploadArea = document.querySelector('.upload-area');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#FFA500';
            uploadArea.style.background = 'rgba(255, 255, 255, 0.2)';
        });
        
        uploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#FFD700';
            uploadArea.style.background = 'rgba(255, 255, 255, 0.1)';
        });
        
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.borderColor = '#FFD700';
            uploadArea.style.background = 'rgba(255, 255, 255, 0.1)';
            
            const files = e.dataTransfer.files;
            if (files.length > 0 && (files[0].name.endsWith('.xlsx') || files[0].name.endsWith('.xls'))) {
                handleFileUpload(files[0]);
            }
        });
        
        function handleFile(e) {
            const file = e.target.files[0];
            if (file) {
                handleFileUpload(file);
            }
        }
        
        function handleFileUpload(file) {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('uploadSection').style.display = 'none';
            document.getElementById('errorMessage').style.display = 'none';
            
            // Start progress simulation for file upload
            startProgressSimulation();
            
            // Set a timeout to ensure loading doesn't take too long
            const loadingTimeout = setTimeout(() => {
                stopProgressSimulation();
                document.getElementById('loading').style.display = 'none';
                showToast('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ÿ®ŸÜÿ¨ÿßÿ≠', 'success');
            }, 5000); // 5 seconds max loading time
            
            const reader = new FileReader();
            reader.onload = function(e) {
                clearTimeout(loadingTimeout);
                
                try {
                    // Update progress to 50% when file is loaded
                    updateProgress(50, 2);
                    
                    const data = new Uint8Array(e.target.result);
                    
                    // Process workbook with performance optimizations
                    const startTime = performance.now();
                    
                    workbook = XLSX.read(data, {
                        type: 'array',
                        cellStyles: false, // Skip cell styles for faster processing
                        cellNF: false, // Skip number formats
                        raw: true // Use raw values
                    });
                    
                    const processingTime = performance.now() - startTime;
                    console.log(`Workbook processed in ${processingTime.toFixed(2)}ms`);
                    
                    // Update progress to 75% when workbook is read
                    updateProgress(75, 3);
                    
                    // Store previous data for comparison (simplified)
                    previousData = {
                        sheets: workbook.SheetNames.length,
                        sheetNames: [...workbook.SheetNames]
                    };
                    
                    // Save data locally
                    saveDataLocally(workbook);
                    
                    // Extract customer names only (optimized)
                    extractNames();
                    
                    // Create sheet buttons
                    createSheetButtons(workbook.SheetNames);
                    
                    // Show sidebar as hidden by default
                    const sidebar = document.getElementById('sidebar');
                    sidebar.style.display = 'none';
                    sidebar.classList.add('hidden');
                    
                    document.getElementById('loading').style.display = 'none';
                    
                    // Stop progress simulation
                    stopProgressSimulation();
                    
                    // Update last refresh time
                    updateLastRefreshTime();
                    
                    // Stop auto refresh for local files
                    if (autoRefreshInterval) {
                        clearInterval(autoRefreshInterval);
                        autoRefreshInterval = null;
                        document.getElementById('autoRefreshIndicator').style.background = '#888';
                    }
                    
                    // Show notification that app is ready
                    setTimeout(() => {
                        showToast('ÿ™ŸÖ ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑŸÖŸÑŸÅ ÿ®ŸÜÿ¨ÿßÿ≠ÿå ÿßÿ∂ÿ∫ÿ∑ ÿπŸÑŸâ ÿßŸÑÿ¥ÿπÿßÿ± ŸÑŸÅÿ™ÿ≠ ÿßŸÑŸÇÿßÿ¶ŸÖÿ©', 'success');
                    }, 300);
                } catch (error) {
                    console.error('Error reading file:', error);
                    stopProgressSimulation();
                    alert('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ŸÇÿ±ÿßÿ°ÿ© ÿßŸÑŸÖŸÑŸÅ. Ÿäÿ±ÿ¨Ÿâ ÿßŸÑÿ™ÿ£ŸÉÿØ ŸÖŸÜ ÿ£ŸÜ ÿßŸÑŸÖŸÑŸÅ ÿµÿßŸÑÿ≠.');
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('uploadSection').style.display = 'block';
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        function createSheetButtons(sheetNames) {
            const sheetButtons = document.getElementById('sheetButtons');
            sheetButtons.innerHTML = '';
            
            sheetNames.forEach((name, index) => {
                const btn = document.createElement('button');
                btn.className = 'sheet-btn';
                if (index === currentSheetIndex) {
                    btn.classList.add('active');
                }
                btn.textContent = name;
                btn.onclick = () => openSheetView(index);
                sheetButtons.appendChild(btn);
            });
        }
        
        function openSheetView(sheetIndex, customerName = null, driverName = null) {
            currentSheetIndex = sheetIndex;
            const sheetName = workbook.SheetNames[sheetIndex];
            const worksheet = workbook.Sheets[sheetName];
            
            // Set sheet title
            if (customerName) {
                document.getElementById('sheetTitle').textContent = `${sheetName} - ${customerName}`;
            } else if (driverName) {
                document.getElementById('sheetTitle').textContent = `${sheetName} - ${driverName}`;
            } else {
                document.getElementById('sheetTitle').textContent = sheetName;
            }
            
            // Show sheet view
            document.getElementById('sheetView').style.display = 'block';
            
            // Create table with simplified processing
            const tableContainer = document.getElementById('sheetView').querySelector('.table-container');
            
            // Use a simpler approach for faster rendering
            const startTime = performance.now();
            
            // Convert sheet to HTML directly
            const html = XLSX.utils.sheet_to_html(worksheet, {
                header: 1,
                editable: false,
                table: {
                    class: 'excel-table'
                }
            });
            
            tableContainer.innerHTML = html;
            
            const processingTime = performance.now() - startTime;
            console.log(`Sheet rendered in ${processingTime.toFixed(2)}ms`);
            
            // Apply minimal formatting
            const table = tableContainer.querySelector('table');
            if (table) {
                // Only apply essential formatting
                applyMinimalFormatting(worksheet, table);
                
                // If there is a specific customer name, hide non-matching rows
                if (customerName && sheetName.trim() === 'ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä') {
                    hideNonMatchingRows(table, customerName, customerNameColumn);
                }
                
                // If there is a specific driver name, hide non-matching rows
                if (driverName && sheetName.trim() === 'ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä') {
                    hideNonMatchingRows(table, driverName, driverNameColumn);
                }
            }
        }
        
        function closeSheetView() {
            const table = document.querySelector('#excelTable');
            if (table) {
                showAllRows(table);
            }
            document.getElementById('sheetView').style.display = 'none';
        }
        
        // Function to hide non-matching rows for a customer or driver
        function hideNonMatchingRows(table, name, nameColumn) {
            const rows = table.querySelectorAll('tr');
            
            for (let i = 1; i < rows.length; i++) { // Start from row 1 to skip header
                const row = rows[i];
                const cells = row.querySelectorAll('td');
                
                if (cells.length > nameColumn) {
                    const nameCell = cells[nameColumn];
                    const cellText = nameCell.textContent.trim();
                    
                    if (cellText !== name) {
                        row.style.display = 'none';
                    } else {
                        row.style.display = '';
                    }
                } else {
                    row.style.display = 'none';
                }
            }
        }
        
        // Function to show all rows again
        function showAllRows(table) {
            const rows = table.querySelectorAll('tr');
            for (let i = 1; i < rows.length; i++) { // Start from row 1 to skip header
                rows[i].style.display = '';
            }
        }
        
        // Simplified formatting function for better performance
        function applyMinimalFormatting(worksheet, table) {
            const rows = table.querySelectorAll('tr');
            
            // Only apply essential formatting
            rows.forEach((row, rowIndex) => {
                const cells = row.querySelectorAll('td, th');
                cells.forEach((cell, colIndex) => {
                    // Only apply header formatting
                    if (rowIndex === 0) {
                        cell.style.background = 'linear-gradient(135deg, var(--accent-primary) 0%, var(--accent-secondary) 100%)';
                        cell.style.color = '#000';
                        cell.style.fontWeight = 'bold';
                        cell.style.position = 'sticky';
                        cell.style.top = '0';
                        cell.style.zIndex = '10';
                    }
                    
                    // Apply hover effect
                    cell.addEventListener('mouseenter', () => {
                        cell.style.backgroundColor = 'rgba(255, 215, 0, 0.1)';
                    });
                    
                    cell.addEventListener('mouseleave', () => {
                        cell.style.backgroundColor = '';
                    });
                });
            });
        }
        
        function refreshData() {
            const refreshBtn = document.getElementById('refreshBtn');
            const updateOverlay = document.getElementById('updateOverlay');
            
            // Show loading state
            refreshBtn.disabled = true;
            refreshBtn.classList.add('loading');
            updateOverlay.classList.add('show');
            
            fetch(GOOGLE_SHEET_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.arrayBuffer();
                })
                .then(data => {
                    try {
                        const newWorkbook = XLSX.read(data, {
                            type: 'array',
                            cellStyles: false,
                            cellNF: false,
                            raw: true
                        });
                        
                        // Simple change detection
                        const hasChanges = newWorkbook.SheetNames.length !== (previousData?.sheets || 0);
                        
                        if (hasChanges) {
                            // Update workbook
                            workbook = newWorkbook;
                            previousData = {
                                sheets: workbook.SheetNames.length,
                                sheetNames: [...workbook.SheetNames]
                            };
                            
                            // Save data locally
                            saveDataLocally(workbook);
                            
                            // Extract customer names
                            extractNames();
                            
                            // Update sheet buttons if needed
                            createSheetButtons(workbook.SheetNames);
                            
                            // Update current sheet if open
                            if (document.getElementById('sheetView').style.display === 'block') {
                                openSheetView(currentSheetIndex);
                            }
                            
                            // Update last refresh time
                            updateLastRefreshTime();
                            
                            // Show notification
                            showToast('ÿ™ŸÖ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'success');
                        } else {
                            showToast('ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™ ŸÖÿ≠ÿØÿ´ÿ© ÿ®ÿßŸÑŸÅÿπŸÑ', 'info');
                        }
                    } catch (error) {
                        console.error('Error processing file:', error);
                        showToast('ÿ≠ÿØÿ´ ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error refreshing data:', error);
                    showToast('ŸÅÿ¥ŸÑ ÿ™ÿ≠ÿØŸäÿ´ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™. ÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿßÿ™ÿµÿßŸÑ ÿßŸÑÿ•ŸÜÿ™ÿ±ŸÜÿ™', 'error');
                })
                .finally(() => {
                    // Hide loading state
                    refreshBtn.disabled = false;
                    refreshBtn.classList.remove('loading');
                    updateOverlay.classList.remove('show');
                });
        }
        
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = `toast ${type}`;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // Initialize Designer Modal
        function initDesignerModal() {
            const designerBtn = document.getElementById('designerBtn');
            const designerModal = document.getElementById('designerModal');
            const modalClose = document.getElementById('modalClose');
            
            // Open modal
            designerBtn.addEventListener('click', function() {
                designerModal.classList.add('show');
            });
            
            // Close modal
            modalClose.addEventListener('click', function() {
                designerModal.classList.remove('show');
            });
            
            // Close when clicking outside modal
            designerModal.addEventListener('click', function(e) {
                if (e.target === designerModal) {
                    designerModal.classList.remove('show');
                }
            });
            
            // Close with ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && designerModal.classList.contains('show')) {
                    designerModal.classList.remove('show');
                }
            });
        }
        
        // Initialize Customer Search
        function initCustomerSearch() {
            const searchInput = document.getElementById('customerSearchInput');
            const searchDropdown = document.getElementById('searchDropdown');
            
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase().trim();
                
                if (searchTerm === '') {
                    searchDropdown.classList.remove('show');
                    return;
                }
                
                // Filter customer names based on search term
                const filteredNames = customerNames.filter(name => 
                    name.toLowerCase().includes(searchTerm)
                );
                
                // Clear dropdown
                searchDropdown.innerHTML = '';
                
                if (filteredNames.length === 0) {
                    const noResultsItem = document.createElement('div');
                    noResultsItem.className = 'search-dropdown-item no-results';
                    noResultsItem.textContent = 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨';
                    searchDropdown.appendChild(noResultsItem);
                } else {
                    filteredNames.forEach(name => {
                        const item = document.createElement('div');
                        item.className = 'search-dropdown-item';
                        item.textContent = name;
                        item.onclick = () => selectCustomer(name);
                        searchDropdown.appendChild(item);
                    });
                }
                
                searchDropdown.classList.add('show');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.customer-search-section .search-container')) {
                    searchDropdown.classList.remove('show');
                }
            });
            
            // Handle Enter key
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const firstItem = searchDropdown.querySelector('.search-dropdown-item:not(.no-results)');
                    if (firstItem) {
                        firstItem.click();
                    }
                }
            });
        }
        
        // Initialize Driver Search
        function initDriverSearch() {
            const searchInput = document.getElementById('driverSearchInput');
            const searchDropdown = document.getElementById('driverSearchDropdown');
            
            searchInput.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase().trim();
                
                if (searchTerm === '') {
                    searchDropdown.classList.remove('show');
                    return;
                }
                
                // Filter driver names based on search term
                const filteredNames = driverNames.filter(name => 
                    name.toLowerCase().includes(searchTerm)
                );
                
                // Clear dropdown
                searchDropdown.innerHTML = '';
                
                if (filteredNames.length === 0) {
                    const noResultsItem = document.createElement('div');
                    noResultsItem.className = 'search-dropdown-item no-results';
                    noResultsItem.textContent = 'ŸÑÿß ÿ™Ÿàÿ¨ÿØ ŸÜÿ™ÿßÿ¶ÿ¨';
                    searchDropdown.appendChild(noResultsItem);
                } else {
                    filteredNames.forEach(name => {
                        const item = document.createElement('div');
                        item.className = 'search-dropdown-item';
                        item.textContent = name;
                        item.onclick = () => selectDriver(name);
                        searchDropdown.appendChild(item);
                    });
                }
                
                searchDropdown.classList.add('show');
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.driver-search-section .search-container')) {
                    searchDropdown.classList.remove('show');
                }
            });
            
            // Handle Enter key
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Enter') {
                    const firstItem = searchDropdown.querySelector('.search-dropdown-item:not(.no-results)');
                    if (firstItem) {
                        firstItem.click();
                    }
                }
            });
        }
        
        // Select customer and open filtered view
        function selectCustomer(customerName) {
            // Close dropdown
            document.getElementById('searchDropdown').classList.remove('show');
            
            // Clear search input
            document.getElementById('customerSearchInput').value = '';
            
            // Find the "ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä" sheet index
            const sheetIndex = workbook.SheetNames.findIndex(name => name.trim() === 'ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä');
            if (sheetIndex === -1) {
                showToast('ÿµŸÅÿ≠ÿ© ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©', 'error');
                return;
            }
            
            // Open sheet view with filtered data
            openSheetView(sheetIndex, customerName);
            
            showToast(`ÿ™ŸÖ ŸÅÿ™ÿ≠ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≤ÿ®ŸàŸÜ: ${customerName}`, 'success');
        }
        
        // Select driver and open filtered view
        function selectDriver(driverName) {
            // Close dropdown
            document.getElementById('driverSearchDropdown').classList.remove('show');
            
            // Clear search input
            document.getElementById('driverSearchInput').value = '';
            
            // Find the "ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä" sheet index
            const sheetIndex = workbook.SheetNames.findIndex(name => name.trim() === 'ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä');
            if (sheetIndex === -1) {
                showToast('ÿµŸÅÿ≠ÿ© ÿØŸÅÿ™ÿ± ÿßŸäÿµÿßŸÑÿßÿ™ ÿ≥ŸÜŸàŸä ÿ∫Ÿäÿ± ŸÖŸàÿ¨ŸàÿØÿ©', 'error');
                return;
            }
            
            // Open sheet view with filtered data
            openSheetView(sheetIndex, null, driverName);
            
            showToast(`ÿ™ŸÖ ŸÅÿ™ÿ≠ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑÿ≥ÿßÿ¶ŸÇ: ${driverName}`, 'success');
        }
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            if (progressInterval) {
                clearInterval(progressInterval);
            }
        });
    </script>
<script>
// ÿßŸÑÿ™ÿ≠ŸÇŸÇ ŸÖŸÜ ÿØÿπŸÖ Service Worker
if ('serviceWorker' in navigator) {
    window.addEventListener('load', function() {
        navigator.serviceWorker.register('sw.js')
            .then(function(registration) {
                console.log('Service Worker registered');
            })
            .catch(function(error) {
                console.log('Service Worker registration failed');
            });
    });
}

// ÿ≤ÿ± ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™
let deferredPrompt;
window.addEventListener('beforeinstallprompt', function(e) {
    e.preventDefault();
    deferredPrompt = e;
    
    // ÿ•ŸÜÿ¥ÿßÿ° ÿ≤ÿ± ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™
    if (!document.getElementById('installBtn')) {
        const installBtn = document.createElement('button');
        installBtn.id = 'installBtn';
        installBtn.innerHTML = 'üì± ÿ´ÿ®Ÿëÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿπŸÑŸâ Ÿáÿßÿ™ŸÅŸÉ';
        installBtn.style.cssText = `
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            color: #000;
            border: none;
            padding: 15px 25px;
            border-radius: 30px;
            font-weight: bold;
            cursor: pointer;
            z-index: 10000;
            font-size: 16px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
            animation: pulse 2s infinite;
            display: flex;
            align-items: center;
            gap: 10px;
        `;
        
        // ÿ•ÿ∂ÿßŸÅÿ© ÿ™ÿ£ÿ´Ÿäÿ± ÿ≠ÿ±ŸÉŸä
        const style = document.createElement('style');
        style.textContent = `
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
        `;
        document.head.appendChild(style);
        
        document.body.appendChild(installBtn);
        
        installBtn.addEventListener('click', function() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then(function(choiceResult) {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('User accepted the install prompt');
                        installBtn.innerHTML = '‚úÖ ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™...';
                        setTimeout(() => {
                            installBtn.remove();
                        }, 2000);
                    }
                    deferredPrompt = null;
                });
            }
        });
    }
});

// ÿ•ÿÆŸÅÿßÿ° ÿ≤ÿ± ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™ ÿ®ÿπÿØ ÿßŸÑÿ™ÿ´ÿ®Ÿäÿ™
window.addEventListener('appinstalled', function() {
    console.log('PWA was installed');
    const installBtn = document.getElementById('installBtn');
    if (installBtn) {
        installBtn.remove();
    }
});
</script>
</body>
</html>